<ion-list *ngIf="categories$ | async as categories">
  <ion-item lines="none" *ngIf="categories.length === 0">
    <ion-label>{{ 'TEXT_NO_CATEGORIES' | translate }}</ion-label>
  </ion-item>

  <ion-accordion-group *ngIf="categories.length > 0">

    <!-- 1 рівень -->
    <ng-container *ngFor="let category of categories">
      <!-- Якщо є дочірні -->
      <ion-accordion *ngIf="category.child && category.child.length > 0" value="{{ category.category_id }}">
        <ion-item slot="header" lines="none">
          <img *ngIf="category.icon" [src]="category.icon" class="category-icon" slot="start" />
          <ion-label>{{ category.name }}</ion-label>
        </ion-item>

        <div class="ion-padding" slot="content">
          <ion-accordion-group>
            <!-- 2 рівень -->
            <ng-container *ngFor="let subCategory of category.child">
              <ion-accordion *ngIf="subCategory.child && subCategory.child.length > 0" value="{{ subCategory.category_id }}">
                <ion-item slot="header" lines="none">
                  <img *ngIf="subCategory.icon" [src]="subCategory.icon" class="category-icon" slot="start" />
                  <ion-label>{{ subCategory.name }}</ion-label>
                </ion-item>

                <div class="ion-padding" slot="content">
                  <ion-accordion-group>
                    <!-- 3 рівень -->
                    <ng-container *ngFor="let subCategory2 of subCategory.child">
                      <ion-accordion *ngIf="subCategory2.child && subCategory2.child.length > 0" value="{{ subCategory2.category_id }}">
                        <ion-item slot="header" lines="none">
                          <img *ngIf="subCategory2.icon" [src]="subCategory2.icon" class="category-icon" slot="start" />
                          <ion-label>{{ subCategory2.name }}</ion-label>
                        </ion-item>

                        <div class="ion-padding" slot="content">
                          <ion-list>
                            <ion-item *ngFor="let subCategory3 of subCategory2.child" button (click)="openCategory(subCategory3.category_id)">
                              <img *ngIf="subCategory3.icon" [src]="subCategory3.icon" class="category-icon" slot="start" />
                              <ion-label>{{ subCategory3.name }}</ion-label>
                            </ion-item>
                          </ion-list>
                        </div>
                      </ion-accordion>

                      <!-- Якщо підкатегорій немає, просто показуємо item -->
                      <ion-item *ngIf="!subCategory2.child || subCategory2.child.length === 0" lines="none" button (click)="openCategory(subCategory2.category_id)">
                        <img *ngIf="subCategory2.icon" [src]="subCategory2.icon" class="category-icon" slot="start" />
                        <ion-label>{{ subCategory2.name }}</ion-label>
                      </ion-item>
                    </ng-container>
                  </ion-accordion-group>
                </div>
              </ion-accordion>

              <!-- Якщо 2-й рівень без дітей -->
              <ion-item *ngIf="!subCategory.child || subCategory.child.length === 0" lines="none" button (click)="openCategory(subCategory.category_id)">
                <img *ngIf="subCategory.icon" [src]="subCategory.icon" class="category-icon" slot="start" />
                <ion-label>{{ subCategory.name }}</ion-label>
              </ion-item>
            </ng-container>
          </ion-accordion-group>
        </div>
      </ion-accordion>

      <!-- Якщо 1-й рівень без дітей -->
      <ion-item *ngIf="!category.child || category.child.length === 0" lines="none" button (click)="openCategory(category.category_id)">
        <img *ngIf="category.icon" [src]="category.icon" class="category-icon" slot="start" />
        <ion-label>{{ category.name }}</ion-label>
      </ion-item>
    </ng-container>
  </ion-accordion-group>
</ion-list>
